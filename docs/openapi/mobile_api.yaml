openapi: 3.1.0
info:
  title: Bite-Size Reader Mobile API
  description: RESTful API for Android/iOS mobile clients
  version: 1.0.0
servers:
  - url: https://bitsizereaderapi.po4yka.com
    description: Production
  - url: https://staging-bitsizereaderapi.po4yka.com
    description: Staging
  - url: http://localhost:8000
    description: Local development
paths:
  /v1/auth/telegram-login:
    post:
      tags:
      - Authentication
      summary: Telegram Login
      description: 'Exchange Telegram authentication data for JWT tokens.


        Verifies Telegram auth hash using HMAC-SHA256 and returns access + refresh
        tokens.


        The authentication data must come from Telegram Login Widget and include:

        - id: Telegram user ID

        - hash: HMAC-SHA256 hash of auth data

        - auth_date: Unix timestamp of authentication

        - client_id: Client application ID

        - Optional: username, first_name, last_name, photo_url'
      operationId: telegram_login_v1_auth_telegram_login_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramLoginRequest'
        required: true
      responses:
        '200':
          description: Login success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/refresh:
    post:
      tags:
      - Authentication
      summary: Refresh Access Token
      description: Refresh an expired access token using a refresh token.
      operationId: refresh_access_token_v1_auth_refresh_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
        required: true
      responses:
        '200':
          description: Tokens refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokensResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/logout:
    post:
      tags:
      - Authentication
      summary: Logout
      description: Revoke the specified refresh token.
      operationId: logout_v1_auth_logout_post
      security:
      - HTTPBearer: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
        required: true
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/sessions:
    get:
      tags:
      - Authentication
      summary: List Active Sessions
      description: List all active refresh token sessions for the current user.
      operationId: list_sessions_v1_auth_sessions_get
      security:
      - HTTPBearer: []
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionListResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/me:
    get:
      tags:
      - Authentication
      summary: Get Current User Info
      description: Get current authenticated user information.
      operationId: get_current_user_info_v1_auth_me_get
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
    delete:
      tags:
      - Authentication
      summary: Delete Account
      description: Delete the current user account and all associated data.
      operationId: delete_account_v1_auth_me_delete
      security:
      - HTTPBearer: []
      responses:
        '200':
          description: Account deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/summaries/{summary_id}/favorite:
    post:
      summary: Toggle favorite status
      operationId: toggleFavorite
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Summaries
      responses:
        200:
          description: Favorite status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /v1/proxy/image:
    get:
      summary: Proxy Image
      description: Proxy an image from a remote URL to bypass CORS/hotlink protection.
      operationId: proxyImage
      parameters:
      - name: url
        in: query
        required: true
        schema:
          type: string
        description: URL of the image to proxy
      tags:
      - Proxy
      responses:
        200:
          description: Image content stream
          content:
            image/*:
              schema:
                type: string
                format: binary
        400:
          $ref: '#/components/responses/ValidationError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'

  /v1/notifications/device:
    post:
      tags:
        - Notifications
      summary: Register mobile device
      description: Register a device token (FCM/APNS) for push notifications.
      operationId: registerDevice
      security:
        - HTTPBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceRegistrationPayload'
      responses:
        '200':
          description: Device registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /v1/collections:
    get:
      summary: List collections
      operationId: getCollections
      security:
      - HTTPBearer: []
      tags:
      - Collections
      responses:
        200:
          description: List of user collections
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionListResponseEnvelope'
    post:
      summary: Create collection
      operationId: createCollection
      security:
      - HTTPBearer: []
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionCreateRequest'
      responses:
        200:
          description: Collection created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResponseEnvelope'

  /v1/collections/{collection_id}:
    get:
      summary: Get collection details
      operationId: getCollection
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      responses:
        200:
          description: Collection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResponseEnvelope'
    patch:
      summary: Update collection
      operationId: updateCollection
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionUpdateRequest'
      responses:
        200:
          description: Collection updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionResponseEnvelope'
    delete:
      summary: Delete collection
      operationId: deleteCollection
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      responses:
        200:
          description: Collection deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /v1/collections/{collection_id}/items:
    post:
      summary: Add item to collection
      operationId: addCollectionItem
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionItemCreateRequest'
      responses:
        200:
          description: Item added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
    get:
      summary: List items in collection
      operationId: listCollectionItems
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 200
          minimum: 1
          default: 50
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
      tags:
      - Collections
      responses:
        200:
          description: Items listed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionItemsResponseEnvelope'

  /v1/collections/{collection_id}/items/{summary_id}:
    delete:
      summary: Remove item from collection
      operationId: removeCollectionItem
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      responses:
        200:
          description: Item removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
  /v1/collections/tree:
    get:
      summary: List collections as tree
      operationId: getCollectionTree
      security:
      - HTTPBearer: []
      tags:
      - Collections
      parameters:
      - name: max_depth
        in: query
        required: false
        schema:
          type: integer
          default: 3
      responses:
        200:
          description: Collection tree
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionTreeResponseEnvelope'
  /v1/collections/{collection_id}/acl:
    get:
      summary: Get collection ACL
      operationId: getCollectionAcl
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      responses:
        200:
          description: ACL entries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionAclResponseEnvelope'
  /v1/collections/{collection_id}/share:
    post:
      summary: Add collaborator
      operationId: addCollectionCollaborator
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionShareRequest'
      responses:
        200:
          description: Collaborator added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
  /v1/collections/{collection_id}/share/{target_user_id}:
    delete:
      summary: Remove collaborator
      operationId: removeCollectionCollaborator
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      - name: target_user_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      responses:
        200:
          description: Collaborator removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
  /v1/collections/{collection_id}/invite:
    post:
      summary: Create invite token
      operationId: createCollectionInvite
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionInviteRequest'
      responses:
        200:
          description: Invite created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionInviteResponseEnvelope'
  /v1/collections/invites/{token}/accept:
    post:
      summary: Accept collection invite
      operationId: acceptCollectionInvite
      security:
      - HTTPBearer: []
      parameters:
      - name: token
        in: path
        required: true
        schema:
          type: string
      tags:
      - Collections
      responses:
        200:
          description: Invite accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
  /v1/collections/{collection_id}/reorder:
    post:
      summary: Reorder child collections
      operationId: reorderCollections
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionReorderRequest'
      responses:
        200:
          description: Reordered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionReorderResponseEnvelope'
  /v1/collections/{collection_id}/items/reorder:
    post:
      summary: Reorder collection items
      operationId: reorderCollectionItems
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionItemReorderRequest'
      responses:
        200:
          description: Items reordered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionReorderResponseEnvelope'
  /v1/collections/{collection_id}/move:
    post:
      summary: Move collection to another parent
      operationId: moveCollection
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionMoveRequest'
      responses:
        200:
          description: Collection moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionMoveResponseEnvelope'
  /v1/collections/{collection_id}/items/move:
    post:
      summary: Move items to another collection
      operationId: moveCollectionItems
      security:
      - HTTPBearer: []
      parameters:
      - name: collection_id
        in: path
        required: true
        schema:
          type: integer
      tags:
      - Collections
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CollectionItemMoveRequest'
      responses:
        200:
          description: Items moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CollectionItemsMoveResponseEnvelope'
  /v1/auth/apple-login:
    post:
      tags:
      - Authentication
      summary: Apple Login
      description: Exchange Apple authentication data for JWT tokens.
      operationId: apple_login_v1_auth_apple_login_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppleLoginRequest'
        required: true
      responses:
        '200':
          description: Login success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokensResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/google-login:
    post:
      tags:
      - Authentication
      summary: Google Login
      description: Exchange Google authentication data for JWT tokens.
      operationId: google_login_v1_auth_google_login_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoogleLoginRequest'
        required: true
      responses:
        '200':
          description: Login success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokensResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/secret-login:
    post:
      tags:
      - Authentication
      summary: Secret Key Login
      description: Exchange a pre-registered client secret for JWT tokens.
      operationId: secret_login_v1_auth_secret_login_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecretLoginRequest'
        required: true
      responses:
        '200':
          description: Login success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokensResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/secret-keys:
    post:
      tags:
      - Authentication
      summary: Create Client Secret (owner-only)
      description: Create or register a client secret for a user. Returns plaintext secret once.
      operationId: create_secret_key_v1_auth_secret_keys_post
      security:
      - HTTPBearer: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecretKeyCreateRequest'
        required: true
      responses:
        '200':
          description: Secret created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretKeyCreateResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
      - Authentication
      summary: List Client Secrets (owner-only)
      description: List client secrets with optional filters.
      operationId: list_secret_keys_v1_auth_secret_keys_get
      security:
      - HTTPBearer: []
      parameters:
      - name: user_id
        in: query
        required: false
        schema:
          type: integer
      - name: client_id
        in: query
        required: false
        schema:
          type: string
      - name: status
        in: query
        required: false
        schema:
          type: string
          enum:
          - active
          - revoked
          - expired
          - locked
      responses:
        '200':
          description: Secrets list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretKeyListResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/secret-keys/{key_id}/rotate:
    post:
      tags:
      - Authentication
      summary: Rotate Client Secret (owner-only)
      description: Rotate an existing client secret; returns plaintext secret once.
      operationId: rotate_secret_key_v1_auth_secret_keys_key_id_rotate_post
      security:
      - HTTPBearer: []
      parameters:
      - name: key_id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecretKeyRotateRequest'
        required: true
      responses:
        '200':
          description: Secret rotated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretKeyCreateResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/secret-keys/{key_id}/revoke:
    post:
      tags:
      - Authentication
      summary: Revoke Client Secret (owner-only)
      description: Revoke an existing client secret.
      operationId: revoke_secret_key_v1_auth_secret_keys_key_id_revoke_post
      security:
      - HTTPBearer: []
      parameters:
      - name: key_id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SecretKeyRevokeRequest'
      responses:
        '200':
          description: Secret revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretKeyActionResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/me/telegram:
    get:
      tags:
      - Authentication
      summary: Get Telegram Link Status
      description: Return current Telegram linkage state for the authenticated user.
      operationId: get_telegram_link_status_v1_auth_me_telegram_get
      security:
      - HTTPBearer: []
      responses:
        '200':
          description: Link status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelegramLinkStatusEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
      - Authentication
      summary: Unlink Telegram Account
      description: Remove Telegram linkage for the authenticated user.
      operationId: unlink_telegram_v1_auth_me_telegram_delete
      security:
      - HTTPBearer: []
      responses:
        '200':
          description: Unlinked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelegramLinkStatusEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/me/telegram/link:
    post:
      tags:
      - Authentication
      summary: Begin Telegram Linking
      description: Issue a nonce to start Telegram linking via Telegram Login Widget.
      operationId: begin_telegram_link_v1_auth_me_telegram_link_post
      security:
      - HTTPBearer: []
      responses:
        '200':
          description: Nonce issued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelegramLinkBeginResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/auth/me/telegram/complete:
    post:
      tags:
      - Authentication
      summary: Complete Telegram Linking
      description: Validate Telegram login payload and nonce to complete linking.
      operationId: complete_telegram_link_v1_auth_me_telegram_complete_post
      security:
      - HTTPBearer: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramLinkCompleteRequest'
        required: true
      responses:
        '200':
          description: Linked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelegramLinkStatusEnvelope'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/summaries:
    get:
      tags:
      - Summaries
      summary: Get Summaries
      description: 'Get paginated list of summaries.


        Query Parameters:

        - limit: Items per page (1-100, default 20)

        - offset: Pagination offset (default 0)

        - is_read: Filter by read status (optional)

        - lang: Filter by language (en/ru/auto)

        - start_date: Filter by creation date (ISO 8601)

        - end_date: Filter by creation date (ISO 8601)

        - sort: Sort order (created_at_desc/created_at_asc)'
      operationId: get_summaries_v1_summaries_get
      security:
      - HTTPBearer: []
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          default: 20
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      - name: is_read
        in: query
        required: false
        schema:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Is Read
      - name: is_favorited
        in: query
        required: false
        schema:
          anyOf:
          - type: boolean
          - type: 'null'
          title: Is Favorited
      - name: lang
        in: query
        required: false
        schema:
          anyOf:
          - type: string
            pattern: ^(en|ru|auto)$
          - type: 'null'
          title: Lang
      - name: start_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: Start Date
      - name: end_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
          title: End Date
      - name: sort
        in: query
        required: false
        schema:
          type: string
          pattern: ^(created_at_desc|created_at_asc)$
          default: created_at_desc
          title: Sort
      responses:
        '200':
          description: Paginated summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSummariesResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/summaries/{summary_id}:
    get:
      tags:
      - Summaries
      summary: Get Summary
      description: Get a single summary with full details.
      operationId: get_summary_v1_summaries__summary_id__get
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
          title: Summary Id
      responses:
        '200':
          description: Summary detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryDetailResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
      - Summaries
      summary: Update Summary
      description: Update summary metadata (e.g., mark as read).
      operationId: update_summary_v1_summaries__summary_id__patch
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
          title: Summary Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSummaryRequest'
      responses:
        '200':
          description: Summary updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryUpdateResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
      - Summaries
      summary: Delete Summary
      description: Delete a summary (soft delete).
      operationId: delete_summary_v1_summaries__summary_id__delete
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
          title: Summary Id
      responses:
        '200':
          description: Summary deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryDeleteResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/summaries/{summary_id}/content:
    get:
      tags:
      - Summaries
      summary: Get Summary Content
      description: Get full article content for offline reading (Markdown by default).
      operationId: get_summary_content_v1_summaries__summary_id__content_get
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
          title: Summary Id
      - name: format
        in: query
        required: false
        schema:
          type: string
          enum:
          - markdown
          - text
          default: markdown
          title: Format
      responses:
        '200':
          description: Summary content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryContentResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/requests:
    post:
      tags:
      - Requests
      summary: Submit Request
      description: 'Submit a new URL or forwarded message for processing.


        Returns request_id and correlation_id for status polling.

        Checks for duplicates and returns existing summary if found.

        Processing happens asynchronously in the background.'
      operationId: submit_request_v1_requests_post
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
              - $ref: '#/components/schemas/SubmitURLRequest'
              - $ref: '#/components/schemas/SubmitForwardRequest'
              description: Request payload with discriminator on type
        required: true
      responses:
        '200':
          description: Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitRequestResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
  /v1/requests/{request_id}:
    get:
      tags:
      - Requests
      summary: Get Request
      description: Get details about a specific request.
      operationId: get_request_v1_requests__request_id__get
      security:
      - HTTPBearer: []
      parameters:
      - name: request_id
        in: path
        required: true
        schema:
          type: integer
          title: Request Id
      responses:
        '200':
          description: Request detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestDetailResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/requests/{request_id}/status:
    get:
      tags:
      - Requests
      summary: Get Request Status
      description: Poll for real-time processing status.
      operationId: get_request_status_v1_requests__request_id__status_get
      security:
      - HTTPBearer: []
      parameters:
      - name: request_id
        in: path
        required: true
        schema:
          type: integer
          title: Request Id
      responses:
        '200':
          description: Request status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestStatusResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/requests/{request_id}/retry:
    post:
      tags:
      - Requests
      summary: Retry Request
      description: Retry a failed request. Processes asynchronously in the background.
      operationId: retry_request_v1_requests__request_id__retry_post
      security:
      - HTTPBearer: []
      parameters:
      - name: request_id
        in: path
        required: true
        schema:
          type: integer
          title: Request Id
      responses:
        '200':
          description: Request retried
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestRetryResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/search:
    get:
      tags:
      - Search
      summary: Search Summaries
      description: 'Full-text search across all summaries using FTS5.


        Search Syntax:

        - Wildcard: bitcoin*

        - Phrase: "artificial intelligence"

        - Boolean: blockchain AND crypto

        - Exclusion: crypto NOT bitcoin'
      operationId: search_summaries_v1_search_get
      security:
      - HTTPBearer: []
      parameters:
      - name: q
        in: query
        required: true
        schema:
          type: string
          minLength: 2
          maxLength: 200
          title: Q
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          default: 20
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/search/semantic:
    get:
      tags:
      - Search
      summary: Semantic Search Summaries
      description: Semantic search across summaries using Chroma embeddings.
      operationId: semantic_search_summaries_v1_search_semantic_get
      security:
      - HTTPBearer: []
      parameters:
      - name: q
        in: query
        required: true
        schema:
          type: string
          minLength: 2
          maxLength: 200
          title: Q
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          default: 20
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      - name: language
        in: query
        required: false
        schema:
          anyOf:
          - type: string
            minLength: 2
            maxLength: 10
          - type: 'null'
          title: Language
      - name: tags
        in: query
        required: false
        schema:
          anyOf:
          - type: array
            items:
              type: string
          - type: 'null'
          title: Tags
      - name: user_scope
        in: query
        required: false
        schema:
          anyOf:
          - type: string
            minLength: 1
            maxLength: 50
          - type: 'null'
          title: User Scope
      responses:
        '200':
          description: Semantic search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/topics/trending:
    get:
      tags:
      - Search
      summary: Get Trending Topics
      description: Get trending topic tags across recent summaries.
      operationId: get_trending_topics_v1_topics_trending_get
      security:
      - HTTPBearer: []
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          default: 20
          title: Limit
      - name: days
        in: query
        required: false
        schema:
          type: integer
          maximum: 365
          minimum: 1
          default: 30
          title: Days
      responses:
        '200':
          description: Trending topics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrendingTopicsResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/topics/related:
    get:
      tags:
      - Search
      summary: Get Related Summaries
      description: Get summaries related to a specific topic tag.
      operationId: get_related_summaries_v1_topics_related_get
      security:
      - HTTPBearer: []
      parameters:
      - name: tag
        in: query
        required: true
        schema:
          type: string
          minLength: 1
          title: Tag
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          default: 20
          title: Limit
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
          title: Offset
      responses:
        '200':
          description: Related summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelatedTopicsResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/urls/check-duplicate:
    get:
      tags:
      - Search
      summary: Check Duplicate
      description: Check if a URL has already been summarized.
      operationId: check_duplicate_v1_urls_check_duplicate_get
      security:
      - HTTPBearer: []
      parameters:
      - name: url
        in: query
        required: true
        schema:
          type: string
          minLength: 10
          title: Url
      - name: include_summary
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Include Summary
      responses:
        '200':
          description: Duplicate check result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateUrlCheckResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/sync/sessions:
    post:
      tags:
      - Sync
      summary: Create Sync Session
      description: Create or resume a sync session.
      operationId: create_sync_session_v1_sync_sessions_post
      requestBody:
        content:
          application/json:
            schema:
              anyOf:
              - $ref: '#/components/schemas/SyncSessionRequest'
              - type: 'null'
              description: Optional session options
      responses:
        '200':
          description: Sync session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncSessionResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
  /v1/sync/full:
    get:
      tags:
      - Sync
      summary: Full Sync
      description: Fetch full sync data in bounded chunks.
      operationId: full_sync_v1_sync_full_get
      security:
      - HTTPBearer: []
      parameters:
      - name: session_id
        in: query
        required: true
        schema:
          type: string
          description: Sync session identifier
          title: Session Id
        description: Sync session identifier
      - name: limit
        in: query
        required: false
        schema:
          anyOf:
          - type: integer
            maximum: 500
            minimum: 1
          - type: 'null'
          title: Limit
      responses:
        '200':
          description: Full sync chunk
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FullSyncResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '410':
          $ref: '#/components/responses/SessionExpiredError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/sync/delta:
    get:
      tags:
      - Sync
      summary: Delta Sync
      description: Fetch delta sync (created/updated/deleted) since a cursor.
      operationId: delta_sync_v1_sync_delta_get
      security:
      - HTTPBearer: []
      parameters:
      - name: session_id
        in: query
        required: true
        schema:
          type: string
          description: Sync session identifier
          title: Session Id
        description: Sync session identifier
      - name: since
        in: query
        required: true
        schema:
          type: integer
          minimum: 0
          description: Last seen server_version cursor
          title: Since
        description: Last seen server_version cursor
      - name: limit
        in: query
        required: false
        schema:
          anyOf:
          - type: integer
            maximum: 500
            minimum: 1
          - type: 'null'
          title: Limit
      responses:
        '200':
          description: Delta sync data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeltaSyncResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '410':
          $ref: '#/components/responses/SessionExpiredError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/sync/apply:
    post:
      tags:
      - Sync
      summary: Apply Changes
      description: Apply client-side changes with conflict detection.
      operationId: apply_changes_v1_sync_apply_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SyncApplyRequest'
        required: true
      responses:
        '200':
          description: Apply results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncApplyResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '410':
          $ref: '#/components/responses/SessionExpiredError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
  /v1/user/preferences:
    get:
      tags:
      - User
      summary: Get User Preferences
      description: Get user preferences.
      operationId: get_user_preferences_v1_user_preferences_get
      responses:
        '200':
          description: User preferences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPreferencesResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
    patch:
      tags:
      - User
      summary: Update User Preferences
      description: Update user preferences.
      operationId: update_user_preferences_v1_user_preferences_patch
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePreferencesRequest'
        required: true
      responses:
        '200':
          description: Preferences updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPreferencesResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
  /v1/user/stats:
    get:
      tags:
      - User
      summary: Get User Stats
      description: Get user statistics.
      operationId: get_user_stats_v1_user_stats_get
      responses:
        '200':
          description: User stats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserStatsResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
      - HTTPBearer: []
  /:
    get:
      summary: Root
      description: API root endpoint.
      operationId: root__get
      responses:
        '200':
          description: Root ping
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RootResponseEnvelope'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /health:
    get:
      summary: Health Check
      description: Lightweight health check endpoint.
      operationId: health_check_health_get
      tags:
      - Health
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponseEnvelope'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /health/detailed:
    get:
      tags:
      - Health
      summary: Detailed Health Check
      description: Comprehensive health check including database, Redis, and circuit breaker status. Has a 10-second timeout on component checks.
      operationId: detailed_health_check_health_detailed_get
      responses:
        '200':
          description: Detailed health status with component breakdown
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetailedHealthResponseEnvelope'
  /health/ready:
    get:
      tags:
      - Health
      summary: Readiness Probe
      description: Kubernetes readiness probe. Checks database connectivity. Returns 503 if not ready.
      operationId: readiness_check_health_ready_get
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadinessResponseEnvelope'
        '503':
          description: Service is not ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadinessResponseEnvelope'
  /health/live:
    get:
      tags:
      - Health
      summary: Liveness Probe
      description: Kubernetes liveness probe. Minimal check that the process is responsive.
      operationId: liveness_check_health_live_get
      responses:
        '200':
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LivenessResponseEnvelope'
  /metrics:
    get:
      tags:
      - Health
      summary: Prometheus Metrics
      description: Prometheus-compatible metrics endpoint for scraping.
      operationId: metrics_get
      responses:
        '200':
          description: Prometheus text metrics
          content:
            text/plain:
              schema:
                type: string
                description: Prometheus exposition format metrics
  /v1/summaries/by-url:
    get:
      tags:
      - Summaries
      summary: Get Summary by URL
      description: Look up a summary by the original article URL.
      operationId: get_summary_by_url_v1_summaries_by_url_get
      security:
      - HTTPBearer: []
      parameters:
      - name: url
        in: query
        required: true
        schema:
          type: string
        description: Original URL of the article
      responses:
        '200':
          description: Summary detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryDetailResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/system/db-dump:
    get:
      tags:
      - System
      summary: Download Database Backup
      description: Download a consistent SQLite database snapshot. Owner-only. Supports Range header for resumable downloads.
      operationId: download_database_v1_system_db_dump_get
      security:
      - HTTPBearer: []
      parameters:
      - name: Range
        in: header
        required: false
        schema:
          type: string
        description: Byte range for resumable downloads (e.g., "bytes=0-1023")
      responses:
        '200':
          description: SQLite database file
          headers:
            Content-Disposition:
              schema:
                type: string
              description: 'Attachment filename (e.g., bite_size_reader_backup_YYYYMMDD_HHMMSS.sqlite)'
            ETag:
              schema:
                type: string
              description: Entity tag for cache validation
            Accept-Ranges:
              schema:
                type: string
              description: Indicates range request support (bytes)
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '206':
          description: Partial content (range request)
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    head:
      tags:
      - System
      summary: Database Backup Pre-flight
      description: HEAD request for database backup. Returns headers (size, ETag) without body. Owner-only.
      operationId: head_database_v1_system_db_dump_head
      security:
      - HTTPBearer: []
      responses:
        '200':
          description: Headers only (Content-Length, ETag, Accept-Ranges)
          headers:
            Content-Length:
              schema:
                type: integer
              description: Database file size in bytes
            ETag:
              schema:
                type: string
              description: Entity tag for cache validation
            Accept-Ranges:
              schema:
                type: string
              description: Indicates range request support (bytes)
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /v1/articles:
    get:
      tags:
      - Articles
      summary: Get Articles (alias)
      description: 'Alias for GET /v1/summaries. Returns paginated list of summaries.

        This endpoint mirrors /v1/summaries exactly and exists for API naming convenience.'
      operationId: get_articles_v1_articles_get
      security:
      - HTTPBearer: []
      parameters:
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          maximum: 100
          minimum: 1
          default: 20
      - name: offset
        in: query
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
      - name: is_read
        in: query
        required: false
        schema:
          anyOf:
          - type: boolean
          - type: 'null'
      - name: is_favorited
        in: query
        required: false
        schema:
          anyOf:
          - type: boolean
          - type: 'null'
      - name: lang
        in: query
        required: false
        schema:
          anyOf:
          - type: string
            pattern: ^(en|ru|auto)$
          - type: 'null'
      - name: start_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
      - name: end_date
        in: query
        required: false
        schema:
          anyOf:
          - type: string
          - type: 'null'
      - name: sort
        in: query
        required: false
        schema:
          type: string
          pattern: ^(created_at_desc|created_at_asc)$
          default: created_at_desc
      responses:
        '200':
          description: Paginated summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSummariesResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/articles/{summary_id}:
    get:
      tags:
      - Articles
      summary: Get Article (alias)
      description: 'Alias for GET /v1/summaries/{summary_id}. Returns full summary details.'
      operationId: get_article_v1_articles__summary_id__get
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Summary detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryDetailResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
      - Articles
      summary: Update Article (alias)
      description: 'Alias for PATCH /v1/summaries/{summary_id}.'
      operationId: update_article_v1_articles__summary_id__patch
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSummaryRequest'
      responses:
        '200':
          description: Summary updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryUpdateResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags:
      - Articles
      summary: Delete Article (alias)
      description: 'Alias for DELETE /v1/summaries/{summary_id}.'
      operationId: delete_article_v1_articles__summary_id__delete
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Summary deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryDeleteResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/articles/{summary_id}/content:
    get:
      tags:
      - Articles
      summary: Get Article Content (alias)
      description: 'Alias for GET /v1/summaries/{summary_id}/content.'
      operationId: get_article_content_v1_articles__summary_id__content_get
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      - name: format
        in: query
        required: false
        schema:
          type: string
          enum:
          - markdown
          - text
          default: markdown
      responses:
        '200':
          description: Summary content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryContentResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/articles/{summary_id}/favorite:
    post:
      tags:
      - Articles
      summary: Toggle Article Favorite (alias)
      description: 'Alias for POST /v1/summaries/{summary_id}/favorite.'
      operationId: toggle_article_favorite_v1_articles__summary_id__favorite_post
      security:
      - HTTPBearer: []
      parameters:
      - name: summary_id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Favorite status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/articles/by-url:
    get:
      tags:
      - Articles
      summary: Get Article by URL (alias)
      description: 'Alias for GET /v1/summaries/by-url.'
      operationId: get_article_by_url_v1_articles_by_url_get
      security:
      - HTTPBearer: []
      parameters:
      - name: url
        in: query
        required: true
        schema:
          type: string
        description: Original URL of the article
      responses:
        '200':
          description: Summary detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryDetailResponseEnvelope'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    HTTPBearer:
      type: http
      scheme: bearer
  responses:
    BadRequestError:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ForbiddenError:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFoundError:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ConflictError:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    SessionExpiredError:
      description: Sync session expired or invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ValidationError:
      description: Validation Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    TooManyRequestsError:
      description: Too Many Requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    Meta:
      type: object
      description: Response metadata for observability and pagination.
      required:
      - correlation_id
      - timestamp
      - version
      properties:
        correlation_id:
          type: string
          description: Request correlation ID for debugging (always present, may be empty string).
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 response timestamp.
        version:
          type: string
          description: API version string.
        build:
          type: string
          nullable: true
          description: Build identifier (if available).
        pagination:
          $ref: '#/components/schemas/Pagination'
        debug:
          type: object
          nullable: true
          description: Debug information (only in development mode).
    Pagination:
      type: object
      description: Pagination metadata for list responses.
      required:
      - total
      - limit
      - offset
      - has_more
      properties:
        total:
          type: integer
          description: Total number of items matching the query.
        limit:
          type: integer
          description: Maximum items per page.
        offset:
          type: integer
          description: Current offset from start.
        has_more:
          type: boolean
          description: Whether more items are available.
        next_cursor:
          type: integer
          nullable: true
          description: Cursor for next page (if using cursor-based pagination).
    BaseSuccessResponse:
      type: object
      required:
      - success
      - meta
      properties:
        success:
          type: boolean
          const: true
        meta:
          $ref: '#/components/schemas/Meta'
    ErrorObject:
      type: object
      description: Structured error details for programmatic handling.
      required:
      - code
      - errorType
      - message
      - retryable
      - correlation_id
      properties:
        code:
          type: string
          description: Machine-readable error code for programmatic handling.
          enum:
          # Client errors
          - VALIDATION_ERROR
          - UNAUTHORIZED
          - FORBIDDEN
          - NOT_FOUND
          - CONFLICT
          - RATE_LIMIT_EXCEEDED
          - SESSION_EXPIRED
          # Token/Auth errors
          - TOKEN_EXPIRED
          - TOKEN_INVALID
          - TOKEN_REVOKED
          - TOKEN_WRONG_TYPE
          - REFRESH_RATE_LIMITED
          # Sync errors
          - SYNC_SESSION_EXPIRED
          - SYNC_SESSION_NOT_FOUND
          - SYNC_SESSION_FORBIDDEN
          - SYNC_NO_CHANGES
          - SYNC_CONFLICT
          - SYNC_INVALID_ENTITY
          - SYNC_ENTITY_NOT_FOUND
          # Server errors
          - INTERNAL_ERROR
          - DATABASE_ERROR
          - EXTERNAL_API_ERROR
          - PROCESSING_ERROR
          - AUTH_SERVICE_UNAVAILABLE
          # Configuration errors
          - CONFIGURATION_ERROR
          - FEATURE_DISABLED
        errorType:
          type: string
          description: Error category for client-side handling logic.
          enum:
          - authentication
          - authorization
          - validation
          - not_found
          - conflict
          - rate_limit
          - external_service
          - sync
          - internal
          - configuration
        message:
          type: string
          description: Human-readable error message.
        retryable:
          type: boolean
          description: Whether the client should retry the request.
          default: false
        details:
          type: object
          nullable: true
          description: Additional error context (field errors, resource IDs, etc.).
        correlation_id:
          type: string
          description: Request correlation ID for debugging (always present).
        retry_after:
          type: integer
          nullable: true
          description: Seconds to wait before retrying (for rate limit errors).
    ErrorResponse:
      type: object
      required:
      - success
      - error
      - meta
      properties:
        success:
          type: boolean
          const: false
        error:
          $ref: '#/components/schemas/ErrorObject'
        meta:
          $ref: '#/components/schemas/Meta'
    AuthTokens:
      type: object
      required:
      - access_token
      - refresh_token
      - token_type
      - expires_in
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          enum:
          - Bearer
          default: Bearer
        expires_in:
          type: integer
          description: Seconds until access token expiry
        refresh_expires_in:
          type: integer
          nullable: true
    LoginData:
      type: object
      required:
      - tokens
      - user
      properties:
        tokens:
          $ref: '#/components/schemas/AuthTokens'
        user:
          $ref: '#/components/schemas/User'
        preferences:
          $ref: '#/components/schemas/UserPreferences'
          nullable: true
    LoginResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/LoginData'
    AuthTokensResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/AuthTokens'
    SecretLoginRequest:
      type: object
      description: Request body for secret-key based authentication.
      required:
      - user_id
      - client_id
      - secret
      properties:
        user_id:
          type: integer
          description: User ID (must be whitelisted in ALLOWED_USER_IDS).
        client_id:
          type: string
          minLength: 1
          maxLength: 100
          description: Client application identifier.
        secret:
          type: string
          minLength: 8
          description: Secret key for authentication (minimum 8 characters).
        username:
          type: string
          nullable: true
          description: Optional username to associate with the session.
    SecretKeyCreateRequest:
      type: object
      required:
      - user_id
      - client_id
      properties:
        user_id:
          type: integer
        client_id:
          type: string
          minLength: 1
          maxLength: 100
        label:
          type: string
          maxLength: 200
          nullable: true
        description:
          type: string
          maxLength: 500
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
        secret:
          type: string
          nullable: true
          description: Optional client-provided secret; if omitted server generates
        username:
          type: string
          nullable: true
    SecretKeyRotateRequest:
      type: object
      properties:
        label:
          type: string
          maxLength: 200
          nullable: true
        description:
          type: string
          maxLength: 500
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
        secret:
          type: string
          nullable: true
          description: Optional client-provided secret; if omitted server generates
    SecretKeyRevokeRequest:
      type: object
      properties:
        reason:
          type: string
          maxLength: 200
          nullable: true
    ClientSecretInfo:
      type: object
      required:
      - id
      - user_id
      - client_id
      - status
      - failed_attempts
      - created_at
      - updated_at
      properties:
        id:
          type: integer
        user_id:
          type: integer
        client_id:
          type: string
        status:
          type: string
          enum:
          - active
          - revoked
          - expired
          - locked
        label:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
        last_used_at:
          type: string
          format: date-time
          nullable: true
        failed_attempts:
          type: integer
        locked_until:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    SecretKeyCreateResponse:
      type: object
      required:
      - secret
      - key
      properties:
        secret:
          type: string
          description: Plaintext secret (only returned once)
        key:
          $ref: '#/components/schemas/ClientSecretInfo'
    SecretKeyActionResponse:
      type: object
      required:
      - key
      properties:
        key:
          $ref: '#/components/schemas/ClientSecretInfo'
    SecretKeyListResponse:
      type: object
      required:
      - keys
      properties:
        keys:
          type: array
          items:
            $ref: '#/components/schemas/ClientSecretInfo'
    SecretKeyCreateResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SecretKeyCreateResponse'
    SecretKeyActionResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SecretKeyActionResponse'
    SecretKeyListResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SecretKeyListResponse'
    TelegramLinkStatus:
      type: object
      required:
      - linked
      properties:
        linked:
          type: boolean
        telegram_user_id:
          type: integer
          nullable: true
        username:
          type: string
          nullable: true
        photo_url:
          type: string
          nullable: true
        first_name:
          type: string
          nullable: true
        last_name:
          type: string
          nullable: true
        linked_at:
          type: string
          format: date-time
          nullable: true
        link_nonce_expires_at:
          type: string
          format: date-time
          nullable: true
        link_nonce:
          type: string
          nullable: true
    TelegramLinkBeginResponse:
      type: object
      required:
      - nonce
      - expires_at
      properties:
        nonce:
          type: string
        expires_at:
          type: string
          format: date-time
    TelegramLinkCompleteRequest:
      allOf:
      - $ref: '#/components/schemas/TelegramLoginRequest'
      - type: object
        required:
        - nonce
        properties:
          nonce:
            type: string
    TelegramLinkStatusEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/TelegramLinkStatus'
    TelegramLinkBeginResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/TelegramLinkBeginResponse'
    User:
      type: object
      required:
      - id
      - is_owner
      properties:
        id:
          type: integer
        username:
          type: string
          nullable: true
        display_name:
          type: string
          nullable: true
        photo_url:
          type: string
          nullable: true
        is_owner:
          type: boolean
        client_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
          nullable: true
    UserResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/User'
    UserPreferences:
      type: object
      required:
      - user_id
      properties:
        user_id:
          type: integer
          description: User identifier.
        telegram_username:
          type: string
          nullable: true
          description: Telegram username (if linked).
        lang_preference:
          type: string
          enum:
          - auto
          - en
          - ru
          default: auto
          nullable: true
        notification_settings:
          type: object
          additionalProperties: true
          nullable: true
        app_settings:
          type: object
          additionalProperties: true
          nullable: true
    UserPreferencesResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/UserPreferences'
    UserStats:
      type: object
      required:
      - total_summaries
      - unread_count
      - read_count
      - total_reading_time_min
      - average_reading_time_min
      - favorite_topics
      - favorite_domains
      - language_distribution
      properties:
        total_summaries:
          type: integer
        unread_count:
          type: integer
        read_count:
          type: integer
        total_reading_time_min:
          type: integer
        average_reading_time_min:
          type: number
        favorite_topics:
          type: array
          items:
            type: object
            required:
            - topic
            - count
            properties:
              topic:
                type: string
              count:
                type: integer
        favorite_domains:
          type: array
          items:
            type: object
            required:
            - domain
            - count
            properties:
              domain:
                type: string
              count:
                type: integer
        language_distribution:
          type: object
          additionalProperties:
            type: integer
        joined_at:
          type: string
          format: date-time
          nullable: true
        last_summary_at:
          type: string
          format: date-time
          nullable: true
    UserStatsResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/UserStats'
    DeviceRegistrationPayload:
      type: object
      description: Request body for registering a device for push notifications.
      required:
        - token
        - platform
      properties:
        token:
          type: string
          minLength: 1
          maxLength: 500
          description: FCM or APNS device token.
        platform:
          type: string
          enum: [ios, android]
          description: Mobile platform (must be 'ios' or 'android').
        device_id:
          type: string
          nullable: true
          description: Unique device identifier (optional).

    SummaryPayload:
      type: object
      required:
      - summary_250
      - summary_1000
      - tldr
      - key_ideas
      - topic_tags
      - entities
      - estimated_reading_time_min
      properties:
        summary_250:
          type: string
          maxLength: 250
        summary_1000:
          type: string
          maxLength: 1000
        tldr:
          type: string
        key_ideas:
          type: array
          items:
            type: string
          minItems: 1
        topic_tags:
          type: array
          items:
            type: string
        entities:
          type: object
          properties:
            people:
              type: array
              items:
                type: string
            organizations:
              type: array
              items:
                type: string
            locations:
              type: array
              items:
                type: string
        estimated_reading_time_min:
          type: integer
        key_stats:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
              value:
                type: number
              unit:
                type: string
                nullable: true
              source_excerpt:
                type: string
        readability:
          type: object
          properties:
            method:
              type: string
            score:
              type: number
            level:
              type: string
        metadata:
          type: object
          properties:
            title:
              type: string
            canonical_url:
              type: string
            domain:
              type: string
            author:
              type: string
              nullable: true
            published_at:
              type: string
              format: date-time
              nullable: true
            last_updated:
              type: string
              format: date-time
              nullable: true
        extractive_quotes:
          type: array
          nullable: true
          items:
            type: object
            properties:
              text:
                type: string
              source_span:
                type: string
        questions_answered:
          type: array
          nullable: true
          items:
            type: object
            properties:
              question:
                type: string
              answer:
                type: string
        topic_taxonomy:
          type: array
          nullable: true
          items:
            type: object
            properties:
              label:
                type: string
              score:
                type: number
              path:
                type: string
        hallucination_risk:
          type: string
          nullable: true
        confidence:
          type: number
          nullable: true
        insights:
          type: object
          nullable: true
          properties:
            topic_overview:
              type: string
            new_facts:
              type: array
              items:
                type: object
                properties:
                  fact:
                    type: string
                  why_it_matters:
                    type: string
                  confidence:
                    type: number
            open_questions:
              type: array
              items:
                type: string
            caution:
              type: string
              nullable: true
    Summary:
      type: object
      required:
      - id
      - request_id
      - lang
      - is_read
      - version
      - created_at
      - json_payload
      properties:
        id:
          type: integer
        request_id:
          type: integer
        lang:
          type: string
        is_read:
          type: boolean
        version:
          type: integer
        created_at:
          type: string
          format: date-time
        json_payload:
          $ref: '#/components/schemas/SummaryPayload'
        title:
          type: string
          nullable: true
        domain:
          type: string
          nullable: true
        url:
          type: string
          nullable: true
        tldr:
          type: string
          nullable: true
        is_favorited:
          type: boolean
          default: false
    SummaryListItem:
      type: object
      description: Compact summary representation for list views.
      required:
      - id
      - request_id
      - title
      - domain
      - url
      - tldr
      - summary_250
      - reading_time_min
      - topic_tags
      - is_read
      - lang
      - created_at
      - confidence
      - hallucination_risk
      properties:
        id:
          type: integer
          description: Unique summary identifier.
        request_id:
          type: integer
          description: Associated request ID.
        title:
          type: string
          description: Article title.
        domain:
          type: string
          description: Source domain (e.g., example.com).
        url:
          type: string
          description: Original article URL.
        tldr:
          type: string
          description: Concise multi-sentence summary.
        summary_250:
          type: string
          maxLength: 250
          description: Short summary (maximum 250 characters).
        reading_time_min:
          type: integer
          description: Estimated reading time in minutes.
        topic_tags:
          type: array
          items:
            type: string
          description: Topic hashtags (e.g., #technology, #ai).
        is_read:
          type: boolean
          description: Whether the user has marked this as read.
        lang:
          type: string
          enum: [en, ru, auto]
          description: Detected or preferred language.
        created_at:
          type: string
          format: date-time
          description: ISO 8601 creation timestamp.
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: LLM confidence score (0.0-1.0).
        hallucination_risk:
          type: string
          enum: [low, medium, high, unknown]
          description: Assessed hallucination risk level.
        is_favorited:
          type: boolean
          default: false
          description: Whether the user has favorited this summary.
        image_url:
          type: string
          nullable: true
          description: Featured image URL (if available).
    SummaryStats:
      type: object
      required:
      - total_summaries
      - unread_count
      properties:
        total_summaries:
          type: integer
        unread_count:
          type: integer
    PaginatedSummariesData:
      type: object
      required:
      - items
      - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/SummaryListItem'
        stats:
          $ref: '#/components/schemas/SummaryStats'
          nullable: true
        pagination:
          $ref: '#/components/schemas/Pagination'
    PaginatedSummariesResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/PaginatedSummariesData'
    SummaryDetailData:
      type: object
      required:
      - summary
      properties:
        summary:
          $ref: '#/components/schemas/Summary'
        request:
          $ref: '#/components/schemas/Request'
          nullable: true
        source:
          type: object
          nullable: true
          properties:
            url:
              type: string
            title:
              type: string
            domain:
              type: string
            author:
              type: string
              nullable: true
            published_at:
              type: string
              format: date-time
              nullable: true
            http_status:
              type: integer
              nullable: true
            image_url:
              type: string
              nullable: true
        processing:
          type: object
          nullable: true
          properties:
            model:
              type: string
            tokens_used:
              type: integer
            cost_usd:
              type: number
            latency_ms:
              type: integer
            crawl_latency_ms:
              type: integer
            llm_latency_ms:
              type: integer
    SummaryContent:
      type: object
      required:
      - summary_id
      - format
      - content
      - content_type
      - retrieved_at
      properties:
        summary_id:
          type: integer
        request_id:
          type: integer
          nullable: true
        format:
          type: string
          enum:
          - markdown
          - text
        content:
          type: string
          description: Full article content for offline reading.
        content_type:
          type: string
          description: MIME type for the returned content (e.g., text/markdown).
        lang:
          type: string
          nullable: true
        source_url:
          type: string
          nullable: true
        title:
          type: string
          nullable: true
        domain:
          type: string
          nullable: true
        retrieved_at:
          type: string
          format: date-time
        size_bytes:
          type: integer
          nullable: true
        checksum_sha256:
          type: string
          nullable: true
    SummaryContentData:
      type: object
      required:
      - content
      properties:
        content:
          $ref: '#/components/schemas/SummaryContent'
    SummaryContentResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SummaryContentData'
    SummaryDetailResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SummaryDetailData'
    SummaryUpdateResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - id
            - is_read
            - updated_at
            properties:
              id:
                type: integer
              is_read:
                type: boolean
              updated_at:
                type: string
                format: date-time
    SummaryDeleteResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - id
            - deleted_at
            properties:
              id:
                type: integer
              deleted_at:
                type: string
                format: date-time
    SuccessResponse:
      type: object
      required:
      - success
      properties:
        success:
          type: boolean
          const: true
    AppleLoginRequest:
      type: object
      required:
      - id_token
      - client_id
      properties:
        id_token:
          type: string
          description: Identity token from Sign in with Apple
        client_id:
          type: string
          description: Client App ID (Bundle ID)
        authorization_code:
          type: string
          nullable: true
          description: One-time authorization code
        given_name:
          type: string
          nullable: true
        family_name:
          type: string
          nullable: true
    Collection:
      type: object
      required:
      - id
      - name
      - created_at
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        position:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        server_version:
          type: integer
        is_shared:
          type: boolean
          default: false
        share_count:
          type: integer
          nullable: true
        item_count:
          type: integer
          nullable: true
        children:
          type: array
          items:
            $ref: '#/components/schemas/Collection'
          nullable: true
        acl_summary:
          type: object
          nullable: true
          properties:
            total_collaborators:
              type: integer
            roles:
              type: array
              items:
                type: string
    CollectionCreateRequest:
      type: object
      required:
      - name
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        position:
          type: integer
          nullable: true
    CollectionUpdateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        position:
          type: integer
          nullable: true
    CollectionItemCreateRequest:
      type: object
      required:
      - summary_id
      properties:
        summary_id:
          type: integer
    CollectionItem:
      type: object
      required:
      - collection_id
      - summary_id
      - created_at
      properties:
        collection_id:
          type: integer
        summary_id:
          type: integer
        position:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
    CollectionItemsResponse:
      type: object
      required:
      - items
      - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/CollectionItem'
        pagination:
          $ref: '#/components/schemas/Pagination'
    CollectionListResponse:
      type: object
      required:
      - collections
      properties:
        collections:
          type: array
          items:
            $ref: '#/components/schemas/Collection'
    CollectionAclEntry:
      type: object
      required:
      - role
      - status
      properties:
        user_id:
          type: integer
          nullable: true
        role:
          type: string
          enum: [owner, editor, viewer]
        status:
          type: string
          enum: [active, pending, revoked]
        invited_by:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CollectionAclResponse:
      type: object
      required:
      - acl
      properties:
        acl:
          type: array
          items:
            $ref: '#/components/schemas/CollectionAclEntry'
    CollectionTreeResponse:
      type: object
      required:
      - collections
      properties:
        collections:
          type: array
          items:
            $ref: '#/components/schemas/Collection'
    CollectionReorderRequest:
      type: object
      required:
      - items
      properties:
        items:
          type: array
          items:
            type: object
            required: [collection_id, position]
            properties:
              collection_id:
                type: integer
              position:
                type: integer
    CollectionItemReorderRequest:
      type: object
      required:
      - items
      properties:
        items:
          type: array
          items:
            type: object
            required: [summary_id, position]
            properties:
              summary_id:
                type: integer
              position:
                type: integer
    CollectionMoveRequest:
      type: object
      properties:
        parent_id:
          type: integer
          nullable: true
        position:
          type: integer
          nullable: true
    CollectionItemMoveRequest:
      type: object
      required:
      - summary_ids
      - target_collection_id
      properties:
        summary_ids:
          type: array
          items:
            type: integer
        target_collection_id:
          type: integer
        position:
          type: integer
          nullable: true
    CollectionShareRequest:
      type: object
      required:
      - user_id
      - role
      properties:
        user_id:
          type: integer
        role:
          type: string
          enum: [editor, viewer]
    CollectionInviteRequest:
      type: object
      required:
      - role
      properties:
        role:
          type: string
          enum: [editor, viewer]
        expires_at:
          type: string
          format: date-time
          nullable: true
    CollectionInviteResponse:
      type: object
      required:
      - token
      - role
      properties:
        token:
          type: string
        role:
          type: string
        expires_at:
          type: string
          format: date-time
          nullable: true
    CollectionMoveResponse:
      type: object
      required:
      - id
      - parent_id
      - position
      properties:
        id:
          type: integer
        parent_id:
          type: integer
          nullable: true
        position:
          type: integer
        server_version:
          type: integer
        updated_at:
          type: string
          format: date-time
    CollectionItemsMoveResponse:
      type: object
      required:
      - moved_summary_ids
      properties:
        moved_summary_ids:
          type: array
          items:
            type: integer
    CollectionReorderResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SuccessResponse'
    CollectionMoveResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionMoveResponse'
    CollectionItemsMoveResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionItemsMoveResponse'
    CollectionItemsResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionItemsResponse'
    CollectionAclResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionAclResponse'
    CollectionTreeResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionTreeResponse'
    CollectionInviteResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionInviteResponse'
    CollectionResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/Collection'
    CollectionListResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/CollectionListResponse'
    GoogleLoginRequest:
      type: object
      required:
      - id_token
      - client_id
      properties:
        id_token:
          type: string
          description: ID token from Google Sign-In
        client_id:
          type: string
          description: Client App ID
    Request:
      type: object
      required:
      - id
      - type
      - status
      - correlation_id
      - created_at
      properties:
        id:
          type: integer
        type:
          type: string
          enum:
          - url
          - forward
        status:
          type: string
          enum:
          - pending
          - processing
          - success
          - error
        correlation_id:
          type: string
        input_url:
          type: string
          nullable: true
        normalized_url:
          type: string
          nullable: true
        dedupe_hash:
          type: string
          nullable: true
        lang_detected:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
    RequestDetail:
      type: object
      required:
      - request
      properties:
        request:
          $ref: '#/components/schemas/Request'
        crawl_result:
          type: object
          nullable: true
          properties:
            status:
              type: string
            http_status:
              type: integer
              nullable: true
            latency_ms:
              type: integer
              nullable: true
            error:
              type: string
              nullable: true
        llm_calls:
          type: array
          nullable: true
          items:
            type: object
            properties:
              id:
                type: integer
              model:
                type: string
              status:
                type: string
              tokens_prompt:
                type: integer
              tokens_completion:
                type: integer
              cost_usd:
                type: number
              latency_ms:
                type: integer
              created_at:
                type: string
                format: date-time
        summary:
          $ref: '#/components/schemas/SummaryListItem'
          nullable: true
    RequestDetailResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/RequestDetail'
    SubmitRequestData:
      type: object
      required:
      - request_id
      - correlation_id
      - type
      - status
      - is_duplicate
      - created_at
      properties:
        request_id:
          type: integer
        correlation_id:
          type: string
        type:
          type: string
          enum:
          - url
          - forward
        status:
          type: string
          enum:
          - pending
          - processing
          - success
          - failed
        estimated_wait_seconds:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        is_duplicate:
          type: boolean
        duplicate_request_id:
          type: integer
          nullable: true
        duplicate_summary_id:
          type: integer
          nullable: true
        duplicate_summary:
          $ref: '#/components/schemas/SummaryListItem'
          nullable: true
    SubmitRequestResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SubmitRequestData'
    RequestStatusData:
      type: object
      required:
      - request_id
      - status
      - stage
      - can_retry
      - updated_at
      properties:
        request_id:
          type: integer
        status:
          type: string
          enum:
          - pending
          - processing
          - success
          - error
        stage:
          type: string
          enum:
          - pending
          - crawling
          - processing
          - complete
          - failed
          description: Processing stage (maps to RequestStage enum).
        progress:
          type: object
          nullable: true
          properties:
            current_step:
              type: integer
            total_steps:
              type: integer
            percentage:
              type: integer
        estimated_seconds_remaining:
          type: integer
          nullable: true
        queue_position:
          type: integer
          nullable: true
          description: 1-indexed position in processing queue (only when pending).
        error_stage:
          type: string
          nullable: true
          description: Stage where error occurred (only when failed).
        error_type:
          type: string
          nullable: true
          description: Error classification (only when failed).
        error_message:
          type: string
          nullable: true
          description: Human-readable error message (only when failed).
        can_retry:
          type: boolean
          default: false
          description: Whether the request can be retried.
        correlation_id:
          type: string
          nullable: true
        updated_at:
          type: string
          format: date-time
    RequestStatusResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/RequestStatusData'
    RequestRetryResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - new_request_id
            - correlation_id
            - status
            - created_at
            properties:
              new_request_id:
                type: integer
              correlation_id:
                type: string
              status:
                type: string
              created_at:
                type: string
                format: date-time
    SearchResultItem:
      type: object
      required:
      - request_id
      - summary_id
      - url
      - title
      - created_at
      properties:
        request_id:
          type: integer
        summary_id:
          type: integer
        url:
          type: string
        title:
          type: string
        domain:
          type: string
          nullable: true
        snippet:
          type: string
          nullable: true
        tldr:
          type: string
          nullable: true
        published_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        relevance_score:
          type: number
          nullable: true
        topic_tags:
          type: array
          items:
            type: string
        is_read:
          type: boolean
          nullable: true
    SearchResponseData:
      type: object
      required:
      - results
      - pagination
      - query
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResultItem'
        pagination:
          $ref: '#/components/schemas/Pagination'
        query:
          type: string
    SearchResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SearchResponseData'
    TrendingTopic:
      type: object
      required:
      - tag
      - count
      properties:
        tag:
          type: string
        count:
          type: integer
        trend:
          type: string
          nullable: true
        percentage_change:
          type: number
          nullable: true
    TrendingTopicsResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - tags
            properties:
              tags:
                type: array
                items:
                  $ref: '#/components/schemas/TrendingTopic'
              time_range:
                type: object
                nullable: true
                properties:
                  start:
                    type: string
                    format: date-time
                  end:
                    type: string
                    format: date-time
    RelatedSummary:
      type: object
      required:
      - summary_id
      - title
      - tldr
      - created_at
      properties:
        summary_id:
          type: integer
        title:
          type: string
        tldr:
          type: string
        created_at:
          type: string
          format: date-time
    RelatedTopicsResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - tag
            - summaries
            - pagination
            properties:
              tag:
                type: string
              summaries:
                type: array
                items:
                  $ref: '#/components/schemas/RelatedSummary'
              pagination:
                $ref: '#/components/schemas/Pagination'
    DuplicateUrlCheckData:
      type: object
      required:
      - is_duplicate
      - normalized_url
      - dedupe_hash
      properties:
        is_duplicate:
          type: boolean
        normalized_url:
          type: string
        dedupe_hash:
          type: string
        request_id:
          type: integer
          nullable: true
        summary_id:
          type: integer
          nullable: true
        summarized_at:
          type: string
          format: date-time
          nullable: true
        summary:
          $ref: '#/components/schemas/SummaryListItem'
          nullable: true
    DuplicateUrlCheckResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/DuplicateUrlCheckData'
    SyncSessionData:
      type: object
      required:
      - session_id
      - expires_at
      - default_limit
      - max_limit
      properties:
        session_id:
          type: string
        expires_at:
          type: string
          format: date-time
        default_limit:
          type: integer
        max_limit:
          type: integer
        last_issued_since:
          type: integer
          nullable: true
    SyncSessionResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/SyncSessionData'
    SyncEntityEnvelope:
      type: object
      required:
      - entity_type
      - id
      - server_version
      - updated_at
      properties:
        entity_type:
          type: string
          enum:
          - summary
          - request
          - preference
          - stat
          - crawl_result
          - llm_call
        id:
          oneOf:
          - type: integer
          - type: string
        server_version:
          type: integer
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true
        summary:
          $ref: '#/components/schemas/Summary'
          nullable: true
        request:
          $ref: '#/components/schemas/Request'
          nullable: true
        preference:
          $ref: '#/components/schemas/UserPreferences'
          nullable: true
        stat:
          $ref: '#/components/schemas/UserStats'
          nullable: true
    FullSyncItem:
      allOf:
      - $ref: '#/components/schemas/SyncEntityEnvelope'
    FullSyncResponseData:
      type: object
      required:
      - session_id
      - has_more
      - items
      - pagination
      properties:
        session_id:
          type: string
        has_more:
          type: boolean
        next_since:
          type: integer
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/FullSyncItem'
        pagination:
          $ref: '#/components/schemas/Pagination'
    FullSyncResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/FullSyncResponseData'
    DeltaSyncResponseData:
      type: object
      required:
      - session_id
      - since
      - has_more
      - created
      - updated
      - deleted
      properties:
        session_id:
          type: string
        since:
          type: integer
        has_more:
          type: boolean
        next_since:
          type: integer
          nullable: true
        created:
          type: array
          items:
            $ref: '#/components/schemas/SyncEntityEnvelope'
        updated:
          type: array
          items:
            $ref: '#/components/schemas/SyncEntityEnvelope'
        deleted:
          type: array
          items:
            $ref: '#/components/schemas/SyncEntityEnvelope'
    DeltaSyncResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/DeltaSyncResponseData'
    SyncApplyResult:
      type: object
      required:
      - id
      - entity_type
      - status
      properties:
        id:
          oneOf:
          - type: integer
          - type: string
        entity_type:
          type: string
        status:
          type: string
          enum:
          - applied
          - conflict
          - invalid
        server_version:
          type: integer
          nullable: true
        server_snapshot:
          $ref: '#/components/schemas/SyncEntityEnvelope'
          nullable: true
        error_code:
          type: string
          nullable: true
        message:
          type: string
          nullable: true
    SyncApplyResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - session_id
            - results
            properties:
              session_id:
                type: string
              results:
                type: array
                items:
                  $ref: '#/components/schemas/SyncApplyResult'
              conflicts:
                type: array
                nullable: true
                items:
                  $ref: '#/components/schemas/SyncApplyResult'
              has_more:
                type: boolean
                nullable: true
    RootResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            properties:
              message:
                type: string
    HealthResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            properties:
              status:
                type: string
                example: ok
    ForwardMetadata:
      properties:
        from_chat_id:
          type: integer
          minimum: 1
          description: Telegram chat ID where the message was forwarded from.
        from_message_id:
          type: integer
          minimum: 1
          description: Telegram message ID of the forwarded message.
        from_chat_title:
          anyOf:
          - type: string
          - type: 'null'
          description: Title of the source chat (if available).
        forwarded_at:
          anyOf:
          - type: string
          - type: 'null'
          description: ISO 8601 timestamp when message was forwarded.
      type: object
      required:
      - from_chat_id
      - from_message_id
      title: ForwardMetadata
      description: Metadata for forwarded Telegram message.
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
      type: object
      title: HTTPValidationError
    RefreshTokenRequest:
      properties:
        refresh_token:
          type: string
      type: object
      required:
      - refresh_token
      title: RefreshTokenRequest
      description: Request body for token refresh.
    SubmitForwardRequest:
      properties:
        type:
          type: string
          const: forward
          default: forward
        content_text:
          type: string
          maxLength: 100000
          minLength: 10
        forward_metadata:
          $ref: '#/components/schemas/ForwardMetadata'
        lang_preference:
          type: string
          enum:
          - auto
          - en
          - ru
          default: auto
      type: object
      required:
      - content_text
      - forward_metadata
      title: SubmitForwardRequest
      description: Request body for submitting a forwarded message.
    SubmitURLRequest:
      properties:
        type:
          type: string
          const: url
          default: url
          description: Request type (always 'url' for URL submissions).
        input_url:
          type: string
          maxLength: 2048
          minLength: 1
          format: uri
          description: URL to summarize (must be http:// or https://).
        lang_preference:
          type: string
          enum:
          - auto
          - en
          - ru
          default: auto
          description: Preferred language for the summary.
      type: object
      required:
      - input_url
      title: SubmitURLRequest
      description: Request body for submitting a URL.
    SyncApplyItem:
      properties:
        entity_type:
          type: string
          enum:
          - summary
          - request
          - preference
          - stat
          - crawl_result
          - llm_call
        id:
          anyOf:
          - type: integer
          - type: string
        action:
          type: string
          enum:
          - update
          - delete
        last_seen_version:
          type: integer
          minimum: 0
        payload:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
        client_timestamp:
          anyOf:
          - type: string
          - type: 'null'
      type: object
      required:
      - entity_type
      - id
      - action
      - last_seen_version
      title: SyncApplyItem
      description: Single change to upload during sync.
    SyncApplyRequest:
      properties:
        session_id:
          type: string
        changes:
          items:
            $ref: '#/components/schemas/SyncApplyItem'
          type: array
      type: object
      required:
      - session_id
      - changes
      title: SyncApplyRequest
      description: Request body for applying local changes.
    SyncSessionRequest:
      properties:
        limit:
          anyOf:
          - type: integer
            maximum: 500
            minimum: 1
          - type: 'null'
      type: object
      title: SyncSessionRequest
      description: Session creation options.
    TelegramLoginRequest:
      properties:
        id:
          type: integer
        hash:
          type: string
        auth_date:
          type: integer
        username:
          anyOf:
          - type: string
          - type: 'null'
        first_name:
          anyOf:
          - type: string
          - type: 'null'
        last_name:
          anyOf:
          - type: string
          - type: 'null'
        photo_url:
          anyOf:
          - type: string
          - type: 'null'
        client_id:
          type: string
          maxLength: 100
          minLength: 1
          description: Client application ID (e.g., 'android-app-v1.0', 'ios-app-v2.0')
      type: object
      required:
      - id
      - hash
      - auth_date
      - client_id
      title: TelegramLoginRequest
      description: Request body for Telegram login.
    UpdatePreferencesRequest:
      properties:
        lang_preference:
          anyOf:
          - type: string
            enum:
            - auto
            - en
            - ru
          - type: 'null'
        notification_settings:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
        app_settings:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
      type: object
      title: UpdatePreferencesRequest
      description: Request body for updating user preferences.
    UpdateSummaryRequest:
      properties:
        is_read:
          anyOf:
          - type: boolean
          - type: 'null'
      type: object
      title: UpdateSummaryRequest
      description: Request body for updating a summary.
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
        msg:
          type: string
        type:
          type: string
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError

    SessionInfo:
      type: object
      required:
      - id
      - client_id
      - device_info
      - ip_address
      - last_used_at
      - created_at
      properties:
        id:
          type: integer
        client_id:
          type: string
          nullable: true
        device_info:
          type: string
          nullable: true
        ip_address:
          type: string
          nullable: true
        last_used_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        is_current:
          type: boolean
          default: false
    SessionListResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            type: object
            required:
            - sessions
            properties:
              sessions:
                type: array
                items:
                  $ref: '#/components/schemas/SessionInfo'
    BaseResponse:
      type: object
      required:
      - status
      properties:
        status:
          type: string
          description: Status indicator (e.g., "ok").
    HealthComponentStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy, degraded, unknown]
        latency_ms:
          type: number
          nullable: true
        details:
          type: object
          nullable: true
          additionalProperties: true
    DetailedHealthData:
      type: object
      required:
      - status
      - timestamp
      properties:
        status:
          type: string
          enum: [healthy, unhealthy, degraded]
        timestamp:
          type: string
          format: date-time
        components:
          type: object
          properties:
            database:
              $ref: '#/components/schemas/HealthComponentStatus'
            redis:
              $ref: '#/components/schemas/HealthComponentStatus'
            circuit_breakers:
              $ref: '#/components/schemas/HealthComponentStatus'
    DetailedHealthResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/DetailedHealthData'
    ReadinessData:
      type: object
      required:
      - ready
      - timestamp
      properties:
        ready:
          type: boolean
        timestamp:
          type: string
          format: date-time
    ReadinessResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/ReadinessData'
    LivenessData:
      type: object
      required:
      - alive
      - timestamp
      properties:
        alive:
          type: boolean
        timestamp:
          type: string
          format: date-time
    LivenessResponseEnvelope:
      allOf:
      - $ref: '#/components/schemas/BaseSuccessResponse'
      - type: object
        required:
        - data
        properties:
          data:
            $ref: '#/components/schemas/LivenessData'
