# API Error Codes Reference

Complete reference of error codes returned by Bite-Size Reader's external APIs and internal systems.

**Audience:** Developers, Integrators
**Type:** Reference
**Related:** [TROUBLESHOOTING](../TROUBLESHOOTING.md), [Mobile API Spec](../MOBILE_API_SPEC.md)

---

## Error Response Format

### Mobile API (REST)

**Standard Error Response:**

```json
{
  "error": {
    "code": "INVALID_TOKEN",
    "message": "JWT token is invalid or expired",
    "details": {
      "correlation_id": "req_abc123",
      "timestamp": "2026-02-09T14:32:15Z"
    }
  }
}
```

**HTTP Status Codes:**

- `400` - Bad Request (client error)
- `401` - Unauthorized (invalid/missing auth)
- `403` - Forbidden (insufficient permissions)
- `404` - Not Found (resource doesn't exist)
- `409` - Conflict (sync conflict)
- `422` - Unprocessable Entity (validation failed)
- `429` - Too Many Requests (rate limited)
- `500` - Internal Server Error (server error)
- `503` - Service Unavailable (maintenance/overload)

---

### Telegram Bot

**User-Visible Error Format:**

```
❌ Error: <user-friendly message>

Error ID: req_abc123

<optional troubleshooting hint>
```

**Example:**

```
❌ Error: Failed to extract content from this URL. The website may be blocking automated access.

Error ID: req_abc123

Try:
- Checking if the URL is accessible in your browser
- Using a different URL format
- Waiting a few minutes and trying again
```

---

## Authentication Errors (40x)

### AUTH001: Missing Token

**HTTP Status:** `401 Unauthorized`

**Cause:** No `Authorization` header in request

**Response:**

```json
{
  "error": {
    "code": "AUTH001",
    "message": "Authorization header is missing"
  }
}
```

**Resolution:** Include `Authorization: Bearer <token>` header

---

### AUTH002: Invalid Token

**HTTP Status:** `401 Unauthorized`

**Cause:** JWT token is malformed or signature verification failed

**Response:**

```json
{
  "error": {
    "code": "AUTH002",
    "message": "JWT token is invalid"
  }
}
```

**Resolution:**

- Verify token was generated by Bite-Size Reader
- Check token hasn't been tampered with
- Re-authenticate via `/auth/telegram-login`

---

### AUTH003: Expired Token

**HTTP Status:** `401 Unauthorized`

**Cause:** JWT access token has expired (default TTL: 1 hour)

**Response:**

```json
{
  "error": {
    "code": "AUTH003",
    "message": "JWT token has expired"
  }
}
```

**Resolution:** Refresh token using `/auth/refresh` endpoint with refresh token

---

### AUTH004: Invalid Refresh Token

**HTTP Status:** `401 Unauthorized`

**Cause:** Refresh token is invalid, expired, or revoked

**Response:**

```json
{
  "error": {
    "code": "AUTH004",
    "message": "Refresh token is invalid or expired"
  }
}
```

**Resolution:** Full re-authentication via `/auth/telegram-login` required

---

### AUTH005: Telegram Auth Failed

**HTTP Status:** `401 Unauthorized`

**Cause:** Telegram authentication failed (invalid `telegram_user_id` or `telegram_auth_token`)

**Response:**

```json
{
  "error": {
    "code": "AUTH005",
    "message": "Telegram authentication failed",
    "details": {
      "reason": "User ID not in whitelist"
    }
  }
}
```

**Resolution:**

- Verify `telegram_user_id` matches Telegram bot user
- Verify user ID is in `ALLOWED_USER_IDS` env var
- Re-authenticate in Telegram bot first

---

### AUTH006: Forbidden

**HTTP Status:** `403 Forbidden`

**Cause:** User does not have permission to access resource

**Response:**

```json
{
  "error": {
    "code": "AUTH006",
    "message": "Insufficient permissions"
  }
}
```

**Resolution:** Verify user owns the requested resource

---

## Validation Errors (422)

### VAL001: Invalid URL

**HTTP Status:** `422 Unprocessable Entity`

**Cause:** URL format is invalid or unsupported

**Telegram Response:**

```
❌ Error: Invalid URL format

Error ID: req_abc123

The URL must start with http:// or https://
```

**Mobile API Response:**

```json
{
  "error": {
    "code": "VAL001",
    "message": "Invalid URL format",
    "details": {
      "url": "not-a-url",
      "reason": "URL must start with http:// or https://"
    }
  }
}
```

**Resolution:** Use valid HTTP/HTTPS URL

---

### VAL002: Missing Required Field

**HTTP Status:** `422 Unprocessable Entity`

**Cause:** Required field missing from request body

**Response:**

```json
{
  "error": {
    "code": "VAL002",
    "message": "Missing required field",
    "details": {
      "field": "telegram_user_id",
      "location": "body"
    }
  }
}
```

**Resolution:** Include all required fields in request

---

### VAL003: Invalid Field Type

**HTTP Status:** `422 Unprocessable Entity`

**Cause:** Field has incorrect type (e.g., string instead of integer)

**Response:**

```json
{
  "error": {
    "code": "VAL003",
    "message": "Invalid field type",
    "details": {
      "field": "limit",
      "expected": "integer",
      "received": "string"
    }
  }
}
```

**Resolution:** Use correct field type

---

### VAL004: Field Out of Range

**HTTP Status:** `422 Unprocessable Entity`

**Cause:** Field value exceeds allowed range

**Response:**

```json
{
  "error": {
    "code": "VAL004",
    "message": "Field value out of range",
    "details": {
      "field": "limit",
      "value": 1000,
      "min": 1,
      "max": 100
    }
  }
}
```

**Resolution:** Use value within allowed range

---

## Content Extraction Errors (EXT)

### EXT001: Firecrawl API Error

**HTTP Status:** N/A (Telegram only)

**Cause:** Firecrawl API returned error (rate limit, timeout, invalid URL)

**Telegram Response:**

```
❌ Error: Failed to extract content from this URL

Error ID: req_abc123

The content extraction service returned an error. This may be temporary.

Try again in a few minutes.
```

**Logged Details:**

```json
{
  "error_code": "EXT001",
  "firecrawl_status": 429,
  "firecrawl_message": "Rate limit exceeded",
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Wait for rate limit to reset (check `X-RateLimit-Reset` header)
- Verify Firecrawl API key is valid
- Check Firecrawl service status

---

### EXT002: Firecrawl Timeout

**HTTP Status:** N/A (Telegram only)

**Cause:** Firecrawl API took longer than configured timeout

**Telegram Response:**

```
❌ Error: Content extraction timed out

Error ID: req_abc123

The website took too long to respond. This may be a slow or complex page.

Try:
- A simpler page from the same site
- Waiting a few minutes and trying again
```

**Logged Details:**

```json
{
  "error_code": "EXT002",
  "timeout_sec": 90,
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Increase `FIRECRAWL_TIMEOUT_SEC` env var
- Try URL in browser to verify it loads
- Use alternative content extraction (Trafilatura fallback)

---

### EXT003: Content Too Large

**HTTP Status:** N/A (Telegram only)

**Cause:** Extracted content exceeds maximum length

**Telegram Response:**

```
❌ Error: Content is too large to summarize

Error ID: req_abc123

The extracted content is <size> characters, exceeding the limit of <max_size> characters.
```

**Logged Details:**

```json
{
  "error_code": "EXT003",
  "content_length": 500000,
  "max_length": 200000,
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Enable chunking (`CHUNKING_ENABLED=true`)
- Increase `CHUNK_MAX_CHARS` limit
- Summarize a shorter article

---

### EXT004: Unsupported Content Type

**HTTP Status:** N/A (Telegram only)

**Cause:** Content type cannot be summarized (images, binaries, etc.)

**Telegram Response:**

```
❌ Error: Cannot summarize this content type

Error ID: req_abc123

Supported types: web articles, YouTube videos, PDFs, text documents.
```

**Resolution:** Use supported content type

---

## LLM Errors (LLM)

### LLM001: OpenRouter API Error

**HTTP Status:** N/A (Telegram only)

**Cause:** OpenRouter API returned error (rate limit, invalid model, etc.)

**Telegram Response:**

```
❌ Error: LLM service error

Error ID: req_abc123

The language model service is temporarily unavailable. Trying fallback model...
```

**Logged Details:**

```json
{
  "error_code": "LLM001",
  "openrouter_status": 503,
  "openrouter_message": "Model temporarily unavailable",
  "model": "deepseek/deepseek-v3.2",
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Wait for OpenRouter service to recover
- Use fallback model (configured in `OPENROUTER_FALLBACK_MODELS`)
- Switch primary model to more reliable option

---

### LLM002: Invalid JSON Response

**HTTP Status:** N/A (Telegram only)

**Cause:** LLM returned malformed JSON that couldn't be parsed

**Telegram Response:**

```
❌ Error: Summary generation failed

Error ID: req_abc123

The language model returned invalid output. Retrying with corrective feedback...
```

**Logged Details:**

```json
{
  "error_code": "LLM002",
  "llm_response_preview": "{\"summary\": \"...",
  "parse_error": "Expecting ',' delimiter",
  "retry_attempt": 1,
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Self-correction loop retries automatically (up to 3x)
- JSON repair attempted via `json-repair` library
- If all retries fail, logged for manual review

---

### LLM003: Validation Failed

**HTTP Status:** N/A (Telegram only)

**Cause:** LLM output failed summary contract validation (missing fields, character limits violated)

**Telegram Response:**

```
❌ Error: Summary validation failed

Error ID: req_abc123

The generated summary did not meet quality requirements. Retrying...
```

**Logged Details:**

```json
{
  "error_code": "LLM003",
  "validation_errors": [
    {"field": "key_ideas", "error": "Field required"},
    {"field": "summary_250", "error": "Length 300 exceeds max 250"}
  ],
  "retry_attempt": 2,
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Self-correction loop retries with error feedback
- Validation backfills missing optional fields
- If all retries fail, logged for prompt engineering review

---

### LLM004: Token Limit Exceeded

**HTTP Status:** N/A (Telegram only)

**Cause:** Content + prompt exceeds model's token limit

**Telegram Response:**

```
❌ Error: Content too long for language model

Error ID: req_abc123

The content is too long to process in one request. Enabling chunking...
```

**Logged Details:**

```json
{
  "error_code": "LLM004",
  "content_tokens": 150000,
  "model_max_tokens": 128000,
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Enable chunking (`CHUNKING_ENABLED=true`)
- Reduce `MAX_CONTENT_LENGTH_TOKENS`
- Use model with larger context window

---

## YouTube Errors (YT)

### YT001: yt-dlp Failed

**HTTP Status:** N/A (Telegram only)

**Cause:** yt-dlp failed to download video (geo-restrictions, age-restricted, removed, etc.)

**Telegram Response:**

```
❌ Error: YouTube download failed

Error ID: req_abc123

Unable to download video. This may be due to geo-restrictions or the video being private/removed.
```

**Logged Details:**

```json
{
  "error_code": "YT001",
  "yt_dlp_error": "Video unavailable",
  "url": "https://youtube.com/watch?v=...",
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Verify video is publicly accessible
- Check for geo-restrictions (use VPN if needed)
- Disable video download, use transcript only (`YOUTUBE_DOWNLOAD_VIDEO=false`)

---

### YT002: Transcript Unavailable

**HTTP Status:** N/A (Telegram only)

**Cause:** YouTube video has no auto-generated or manual transcript

**Telegram Response:**

```
❌ Error: No transcript available

Error ID: req_abc123

This video does not have captions/subtitles. Cannot summarize without transcript.
```

**Logged Details:**

```json
{
  "error_code": "YT002",
  "url": "https://youtube.com/watch?v=...",
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Enable video download and use audio transcription (requires `YOUTUBE_DOWNLOAD_VIDEO=true` + transcription service)
- Find video with captions enabled

---

### YT003: ffmpeg Not Found

**HTTP Status:** N/A (Telegram only)

**Cause:** ffmpeg binary not installed or not in PATH

**Telegram Response:**

```
❌ Error: Video processing unavailable

Error ID: req_abc123

ffmpeg is required for video processing but was not found.
```

**Logged Details:**

```json
{
  "error_code": "YT003",
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Install ffmpeg: `apt-get install ffmpeg` (Debian/Ubuntu) or `brew install ffmpeg` (macOS)
- Verify ffmpeg is in PATH: `which ffmpeg`

---

## Database Errors (DB)

### DB001: Database Locked

**HTTP Status:** `500 Internal Server Error`

**Cause:** SQLite database is locked by another process

**Response:**

```json
{
  "error": {
    "code": "DB001",
    "message": "Database is temporarily locked",
    "details": {
      "retry_after_ms": 1000
    }
  }
}
```

**Resolution:**

- Wait and retry (automatic retry with exponential backoff)
- Check for long-running queries or transactions
- Increase `DB_TIMEOUT_MS` env var

---

### DB002: Database Corruption

**HTTP Status:** `500 Internal Server Error`

**Cause:** SQLite database file is corrupted

**Telegram Response:**

```
❌ Critical Error: Database corruption detected

Error ID: req_abc123

The database may be corrupted. Please restore from backup.
```

**Logged Details:**

```json
{
  "error_code": "DB002",
  "corruption_details": "database disk image is malformed",
  "correlation_id": "req_abc123"
}
```

**Resolution:**

- Stop bot immediately
- Attempt recovery: `sqlite3 data/app.db ".recover" | sqlite3 data/app.db.recovered`
- Restore from backup if recovery fails

See: [Backup and Restore](../how-to/backup-and-restore.md)

---

### DB003: Migration Failed

**HTTP Status:** N/A (startup failure)

**Cause:** Database migration failed during startup

**Error Message:**

```
FATAL: Database migration failed

Migration: 003_add_collections_table.sql
Error: table "collections" already exists
```

**Resolution:**

- Check migration script for errors
- Verify database state: `sqlite3 data/app.db ".tables"`
- Manually fix schema or restore from backup

---

## Sync Errors (SYNC)

### SYNC001: Sync Conflict

**HTTP Status:** `409 Conflict`

**Cause:** Client and server have conflicting changes for same resource

**Response:**

```json
{
  "error": {
    "code": "SYNC001",
    "message": "Sync conflict detected",
    "details": {
      "resource_type": "summary",
      "resource_id": "summary_xyz",
      "client_version": 5,
      "server_version": 7,
      "resolution": "server_wins"
    }
  }
}
```

**Resolution:**

- Client should re-fetch latest version from server
- Re-apply local changes if desired
- Use full sync to reset client state

---

### SYNC002: Invalid Sync Token

**HTTP Status:** `400 Bad Request`

**Cause:** `sync_token` is invalid or expired

**Response:**

```json
{
  "error": {
    "code": "SYNC002",
    "message": "Invalid sync token",
    "details": {
      "reason": "Token expired or not found"
    }
  }
}
```

**Resolution:** Perform full sync (omit `sync_token` parameter)

---

## Rate Limiting Errors (RATE)

### RATE001: Rate Limit Exceeded

**HTTP Status:** `429 Too Many Requests`

**Cause:** Client exceeded request rate limit

**Response:**

```json
{
  "error": {
    "code": "RATE001",
    "message": "Rate limit exceeded",
    "details": {
      "limit": 100,
      "window_sec": 3600,
      "retry_after_sec": 300
    }
  }
}
```

**Headers:**

```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1707490800
Retry-After: 300
```

**Resolution:** Wait `retry_after_sec` seconds before retrying

---

## System Errors (SYS)

### SYS001: Internal Server Error

**HTTP Status:** `500 Internal Server Error`

**Cause:** Unhandled exception in server code

**Response:**

```json
{
  "error": {
    "code": "SYS001",
    "message": "Internal server error",
    "details": {
      "correlation_id": "req_abc123"
    }
  }
}
```

**Resolution:**

- Check server logs with correlation ID
- Report issue if reproducible

---

### SYS002: Service Unavailable

**HTTP Status:** `503 Service Unavailable`

**Cause:** Server is overloaded, in maintenance mode, or dependency unavailable

**Response:**

```json
{
  "error": {
    "code": "SYS002",
    "message": "Service temporarily unavailable",
    "details": {
      "retry_after_sec": 60
    }
  }
}
```

**Resolution:** Retry after specified delay

---

## Redis Errors (REDIS)

### REDIS001: Connection Failed

**HTTP Status:** N/A (warning only)

**Cause:** Cannot connect to Redis server

**Telegram Response:** (no error shown to user, graceful degradation)

**Logged Details:**

```json
{
  "error_code": "REDIS001",
  "redis_url": "redis://localhost:6379/0",
  "connection_error": "Connection refused",
  "fallback": "caching disabled"
}
```

**Resolution:**

- Start Redis server: `redis-server`
- Verify `REDIS_URL` env var is correct
- Bot continues without cache (performance impact only)

---

## ChromaDB Errors (CHROMA)

### CHROMA001: Connection Failed

**HTTP Status:** N/A (warning only)

**Cause:** Cannot connect to ChromaDB server

**Logged Details:**

```json
{
  "error_code": "CHROMA001",
  "chroma_host": "localhost:8000",
  "connection_error": "Connection refused",
  "fallback": "vector search disabled"
}
```

**Resolution:**

- Start ChromaDB: `docker run -d -p 8000:8000 chromadb/chroma`
- Verify `CHROMA_HOST` env var is correct
- Bot continues without vector search

---

## Error Code Index

**Authentication (40x):**

- `AUTH001` - Missing Token
- `AUTH002` - Invalid Token
- `AUTH003` - Expired Token
- `AUTH004` - Invalid Refresh Token
- `AUTH005` - Telegram Auth Failed
- `AUTH006` - Forbidden

**Validation (422):**

- `VAL001` - Invalid URL
- `VAL002` - Missing Required Field
- `VAL003` - Invalid Field Type
- `VAL004` - Field Out of Range

**Content Extraction (EXT):**

- `EXT001` - Firecrawl API Error
- `EXT002` - Firecrawl Timeout
- `EXT003` - Content Too Large
- `EXT004` - Unsupported Content Type

**LLM (LLM):**

- `LLM001` - OpenRouter API Error
- `LLM002` - Invalid JSON Response
- `LLM003` - Validation Failed
- `LLM004` - Token Limit Exceeded

**YouTube (YT):**

- `YT001` - yt-dlp Failed
- `YT002` - Transcript Unavailable
- `YT003` - ffmpeg Not Found

**Database (DB):**

- `DB001` - Database Locked
- `DB002` - Database Corruption
- `DB003` - Migration Failed

**Sync (SYNC):**

- `SYNC001` - Sync Conflict
- `SYNC002` - Invalid Sync Token

**Rate Limiting (RATE):**

- `RATE001` - Rate Limit Exceeded

**System (SYS):**

- `SYS001` - Internal Server Error
- `SYS002` - Service Unavailable

**Redis (REDIS):**

- `REDIS001` - Connection Failed (non-fatal)

**ChromaDB (CHROMA):**

- `CHROMA001` - Connection Failed (non-fatal)

---

## See Also

- [TROUBLESHOOTING](../TROUBLESHOOTING.md) - Debugging guide
- [Mobile API Spec](../MOBILE_API_SPEC.md) - API documentation
- [FAQ § Errors](../FAQ.md#errors) - Common error questions

---

**Last Updated:** 2026-02-09
